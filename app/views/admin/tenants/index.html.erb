<%# app/views/admin/tenants/index.html.erb %>

<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
  <!-- Page header -->
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-xl font-semibold text-slate-900">„ÉÜ„Éä„É≥„Éà‰∏ÄË¶ß</h1>
      <p class="mt-1 text-xs text-slate-500">
        ‰∏≠Â∞è‰ºÅÊ•≠Âêë„ÅëSaaS„ÅÆÂÖ®„ÉÜ„Éä„É≥„Éà„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åô„ÄÇÊ§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„ÅßÁ¥†Êó©„ÅèÁµû„ÇäËæº„Åø„Åß„Åç„Åæ„Åô„ÄÇ
      </p>
    </div>
    <div class="flex items-center gap-2">
      <button
        class="inline-flex items-center gap-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-700 shadow-sm hover:bg-slate-50"
      >
        CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
      </button>
      <%= link_to "Ôºã Êñ∞Ë¶è„ÉÜ„Éä„É≥„ÉàËøΩÂä†",
                  new_admin_tenant_path,
                  class: "inline-flex items-center gap-1 rounded-lg bg-sky-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-sky-700" %>
    </div>
  </div>

  <!-- Filters -->
  <section class="mb-4 rounded-xl border border-slate-200 bg-white px-4 py-3 shadow-sm sm:px-5">
    <%= form_with url: admin_tenants_path, method: :get, local: true,
                  class: "flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between" do |f| %>

      <!-- Search -->
      <div class="flex flex-1 items-center gap-2">
        <div class="relative flex-1">
          <span class="pointer-events-none absolute inset-y-0 left-2 flex items-center text-slate-400">
            üîç
          </span>
          <%= f.search_field :q,
              value: params[:q],
              placeholder: "„ÉÜ„Éä„É≥„ÉàÂêç / „Éâ„É°„Ç§„É≥ / ÊãÖÂΩìËÄÖ„ÅßÊ§úÁ¥¢",
              class: "w-full rounded-lg border border-slate-200 bg-slate-50 py-1.5 pl-8 pr-3 text-xs text-slate-800 placeholder:text-slate-400 focus:border-sky-500 focus:bg-white focus:outline-none focus:ring-1 focus:ring-sky-500" %>
        </div>
      </div>

      <!-- Filters -->
      <div class="flex flex-wrap items-center gap-2">
        <%= f.select :status,
          options_for_select(
            [
              ["„Çπ„ÉÜ„Éº„Çø„Çπ: „Åô„Åπ„Å¶", ""],
              ["ÊúâÂäπ", "active"],
              ["„Éà„É©„Ç§„Ç¢„É´", "trial"],
              ["‰∏ÄÊôÇÂÅúÊ≠¢", "suspended"]
            ],
            params[:status]
          ),
          {},
          class: "rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs text-slate-700 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500" %>

        <%= f.select :plan,
          options_for_select(
            [
              ["„Éó„É©„É≥: „Åô„Åπ„Å¶", ""],
              ["„Éï„É™„Éº", "free"],
              ["„Çπ„Çø„É≥„ÉÄ„Éº„Éâ", "standard"],
              ["„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫", "enterprise"]
            ],
            params[:plan]
          ),
          {},
          class: "rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs text-slate-700 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500" %>

        <%= f.select :sort,
          options_for_select(
            [
              ["‰∏¶„Å≥È†Ü: ÊúÄËøë„Ç¢„ÇØ„Çª„ÇπÈ†Ü", "recent"],
              ["ÁôªÈå≤Êó•(Êñ∞„Åó„ÅÑÈ†Ü)", "created_desc"],
              ["ÁôªÈå≤Êó•(Âè§„ÅÑÈ†Ü)", "created_asc"],
              ["„ÉÜ„Éä„É≥„ÉàÂêç", "name"]
            ],
            params[:sort]
          ),
          {},
          class: "rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs text-slate-700 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500" %>
      </div>
    <% end %>
  </section>

  <!-- Table -->
  <section class="rounded-xl border border-slate-200 bg-white shadow-sm">
    <!-- table header info -->
    <div class="flex items-center justify-between border-b border-slate-100 px-4 py-2 text-xs text-slate-500">
      <% total_count = @tenants.respond_to?(:total_count) ? @tenants.total_count : @tenants.size %>
      <span>ÂÖ® <%= total_count %> ‰ª∂</span>

      <div class="flex items-center gap-3">
        <label class="inline-flex items-center gap-1">
          <span>„Éö„Éº„Ç∏„ÅÇ„Åü„Çä</span>
          <select class="rounded border border-slate-200 bg-white px-1.5 py-1 text-xs">
            <option>20</option>
            <option>50</option>
            <option>100</option>
          </select>
        </label>
      </div>
    </div>

    <!-- Desktop table -->
    <div class="hidden sm:block">
      <table class="min-w-full text-left text-xs">
        <thead class="bg-slate-50 text-slate-500">
          <tr>
            <th class="w-10 px-4 py-2">
              <input
                type="checkbox"
                class="h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
              />
            </th>
            <th class="px-3 py-2 font-medium">„ÉÜ„Éä„É≥„ÉàÂêç</th>
            <th class="px-3 py-2 font-medium">„Éâ„É°„Ç§„É≥</th>
            <th class="px-3 py-2 font-medium">„Éó„É©„É≥</th>
            <th class="px-3 py-2 font-medium">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
            <th class="px-3 py-2 font-medium">Âà©Áî®ÈñãÂßãÊó•</th>
            <th class="px-3 py-2 font-medium">ÊúÄÁµÇ„Ç¢„ÇØ„Çª„Çπ</th>
            <th class="px-3 py-2 text-right font-medium">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          <% @tenants.each do |tenant| %>
            <%# ==== „Éê„ÉÉ„Ç∏Áî®„ÅÆ„É©„Éô„É´ & „ÇØ„É©„Çπ„ÇíRuby„ÅßÊ±∫ÂÆö ==== %>
            <% plan_label, plan_badge_class =
              case tenant.plan
              when "free"
                ["„Éï„É™„Éº", "bg-slate-50 text-slate-700"]
              when "standard"
                ["„Çπ„Çø„É≥„ÉÄ„Éº„Éâ", "bg-sky-50 text-sky-700"]
              when "enterprise"
                ["„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫", "bg-slate-900/90 text-slate-50"]
              else
                [tenant.plan.to_s, "bg-slate-100 text-slate-600"]
              end %>

            <% status_label, status_badge_class, status_dot_class =
              case tenant.status
              when "active"
                ["ÊúâÂäπ", "bg-emerald-50 text-emerald-700", "bg-emerald-500"]
              when "trial"
                ["„Éà„É©„Ç§„Ç¢„É´‰∏≠", "bg-amber-50 text-amber-700", "bg-amber-500"]
              when "suspended"
                ["‰∏ÄÊôÇÂÅúÊ≠¢", "bg-slate-100 text-slate-600", "bg-slate-400"]
              else
                [tenant.status.to_s, "bg-slate-100 text-slate-600", "bg-slate-400"]
              end %>

            <tr class="hover:bg-slate-50">
              <td class="px-4 py-2 align-middle">
                <input
                  type="checkbox"
                  class="h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
                />
              </td>
              <td class="px-3 py-2 align-middle">
                <div class="flex flex-col">
                  <span class="text-xs font-semibold text-slate-900">
                    <%= tenant.name %>
                  </span>
                  <%# „ÉÜ„Éä„É≥„Éà„Ç≥„Éº„Éâ„ÇÑID„Å™„Å©„ÄÇÂ±ûÊÄßÂêç„ÅØÂÆüÈöõ„ÅÆ„Çπ„Ç≠„Éº„Éû„Å´Âêà„Çè„Åõ„Å¶Â§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ %>
                  <span class="text-[11px] text-slate-500">
                    <%= tenant.code %>
                  </span>
                </div>
              </td>
              <td class="px-3 py-2 align-middle">
                <span class="text-[11px] text-sky-700">
                  <%= tenant.primary_domain %>
                </span>
              </td>
              <td class="px-3 py-2 align-middle">
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium <%= plan_badge_class %>">
                  <%= plan_label %>
                </span>
              </td>
              <td class="px-3 py-2 align-middle">
                <span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium <%= status_badge_class %>">
                  <span class="h-1.5 w-1.5 rounded-full <%= status_dot_class %>"></span>
                  <%= status_label %>
                </span>
              </td>
              <td class="px-3 py-2 align-middle text-[11px] text-slate-600">
                <%= tenant.started_on&.strftime("%Y-%m-%d") %>
              </td>
              <td class="px-3 py-2 align-middle text-[11px] text-slate-600">
                <%= tenant.last_access_at&.strftime("%Y-%m-%d %H:%M") %>
              </td>
              <td class="px-3 py-2 align-middle text-right">
                <div class="inline-flex items-center gap-1.5">
                  <%= link_to "Ë©≥Á¥∞",
                              admin_tenant_path(tenant),
                              class: "rounded border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-600 hover:bg-slate-50" %>

                  <%# „ÉÜ„Éä„É≥„Éà„Å´„É≠„Ç∞„Ç§„É≥„Åô„ÇãÁã¨Ëá™„Ç¢„ÇØ„Ç∑„Éß„É≥„ÅÆ„Éë„Çπ„ÅØ„Ç¢„Éó„É™ÂÅ¥„Å´Âêà„Çè„Åõ„Å¶Â§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ %>
                  <%= link_to "„É≠„Ç∞„Ç§„É≥",
                              "#",
                              class: "rounded border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-600 hover:bg-slate-50" %>

                  <% if tenant.status == "active" || tenant.status == "trial" %>
                    <%= link_to "ÂÅúÊ≠¢",
                                "#",
                                class: "rounded border border-rose-200 bg-rose-50 px-2 py-1 text-[11px] text-rose-600 hover:bg-rose-100" %>
                  <% else %>
                    <%= link_to "ÂÜçÈñã",
                                "#",
                                class: "rounded border border-emerald-200 bg-emerald-50 px-2 py-1 text-[11px] text-emerald-600 hover:bg-emerald-100" %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Mobile cards -->
    <div class="divide-y divide-slate-100 sm:hidden">
      <% @tenants.each do |tenant| %>
        <% plan_label, plan_badge_class =
          case tenant.plan
          when "free"
            ["„Éï„É™„Éº", "bg-slate-50 text-slate-700"]
          when "standard"
            ["„Çπ„Çø„É≥„ÉÄ„Éº„Éâ", "bg-sky-50 text-sky-700"]
          when "enterprise"
            ["„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫", "bg-slate-900/90 text-slate-50"]
          else
            [tenant.plan.to_s, "bg-slate-100 text-slate-600"]
          end %>

        <% status_label, status_badge_class, status_dot_class =
          case tenant.status
          when "active"
            ["ÊúâÂäπ", "bg-emerald-50 text-emerald-700", "bg-emerald-500"]
          when "trial"
            ["„Éà„É©„Ç§„Ç¢„É´‰∏≠", "bg-amber-50 text-amber-700", "bg-amber-500"]
          when "suspended"
            ["‰∏ÄÊôÇÂÅúÊ≠¢", "bg-slate-100 text-slate-600", "bg-slate-400"]
          else
            [tenant.status.to_s, "bg-slate-100 text-slate-600", "bg-slate-400"]
          end %>

        <div class="px-4 py-3">
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="flex items-center gap-2">
                <span class="text-sm font-semibold text-slate-900">
                  <%= tenant.name %>
                </span>
                <span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium <%= status_badge_class %>">
                  <span class="h-1.5 w-1.5 rounded-full <%= status_dot_class %>"></span>
                  <%= status_label %>
                </span>
              </div>
              <p class="mt-0.5 text-[11px] text-slate-500">
                <%= tenant.primary_domain %> „Éª <%= plan_label %>
              </p>
            </div>
            <input
              type="checkbox"
              class="mt-1 h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
            />
          </div>
          <div class="mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] text-slate-500">
            <span>Âà©Áî®ÈñãÂßã: <%= tenant.started_on&.strftime("%Y-%m-%d") %></span>
            <span>ÊúÄÁµÇ„Ç¢„ÇØ„Çª„Çπ: <%= tenant.last_access_at&.strftime("%Y-%m-%d %H:%M") %></span>
          </div>
          <div class="mt-2 flex flex-wrap gap-1.5">
            <%= link_to "Ë©≥Á¥∞",
                        admin_tenant_path(tenant),
                        class: "rounded border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-600 hover:bg-slate-50" %>
            <%= link_to "„É≠„Ç∞„Ç§„É≥",
                        "#",
                        class: "rounded border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-600 hover:bg-slate-50" %>

            <% if tenant.status == "active" || tenant.status == "trial" %>
              <%= link_to "ÂÅúÊ≠¢",
                          "#",
                          class: "rounded border border-rose-200 bg-rose-50 px-2 py-1 text-[11px] text-rose-600 hover:bg-rose-100" %>
            <% else %>
              <%= link_to "ÂÜçÈñã",
                          "#",
                          class: "rounded border border-emerald-200 bg-emerald-50 px-2 py-1 text-[11px] text-emerald-600 hover:bg-emerald-100" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- PaginationÔºà„Åì„Åì„ÅØ„ÅäÂ•Ω„Åø„Åß kaminari / will_paginate „Å´Â∑Æ„ÅóÊõø„ÅàÊé®Â•®Ôºâ -->
    <div class="flex items-center justify-between border-t border-slate-100 px-4 py-3">
      <button
        class="inline-flex items-center rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-600 disabled:opacity-40"
        disabled
      >
        ‚Äπ Ââç„Å∏
      </button>
      <div class="flex items-center gap-1 text-xs">
        <button
          class="inline-flex h-7 w-7 items-center justify-center rounded-full bg-sky-600 text-[11px] font-semibold text-white"
        >
          1
        </button>
        <button
          class="inline-flex h-7 w-7 items-center justify-center rounded-full text-[11px] text-slate-600 hover:bg-slate-100"
        >
          2
        </button>
        <button
          class="inline-flex h-7 w-7 items-center justify-center rounded-full text-[11px] text-slate-600 hover:bg-slate-100"
        >
          3
        </button>
        <span class="px-1 text-slate-400">‚Ä¶</span>
        <button
          class="inline-flex h-7 w-7 items-center justify-center rounded-full text-[11px] text-slate-600 hover:bg-slate-100"
        >
          7
        </button>
      </div>
      <button
        class="inline-flex items-center rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-600 hover:bg-slate-50"
      >
        Ê¨°„Å∏ ‚Ä∫
      </button>
    </div>
  </section>
</div>