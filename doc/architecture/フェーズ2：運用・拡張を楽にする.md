このフェーズの目的は、**「機能は揃ったが、運用・拡張が辛くなる前に“土台”を固めること」**である。
	•	管理画面の運用負荷を下げる
	•	権限・監査・UI の不整合を防ぐ
	•	将来の機能追加・業種追加・法人化に耐えられる構造にする
	•	「人が増えても壊れない」Railsコードにする

⸻

🧭 前提条件
	•	Ruby on Rails 8
	•	マルチテナント構成（tenant_id を全業務テーブルに保持）
	•	既に以下は実装済みであること
	•	テナント / ユーザ / ロール / パーミッション
	•	authorize!(key) / can?(key)
	•	管理画面（Admin 名前空間）
	•	監査ログ（誰が・いつ・何をしたか）

⸻

🧩 フェーズ2で必ず実装すること

1️⃣ 運用しやすい「管理画面基盤」の完成
	•	Admin 配下の共通基盤を整理する
	•	Admin::BaseController
	•	権限チェック・監査ログの強制適用
	•	各画面で以下が自動的に揃うこと
	•	権限がない画面には 遷移不可
	•	見えない操作は ログにも出ない
	•	操作は必ず audit_log に残る

👉 「書き忘れ」が起きない構造にすること

⸻

2️⃣ 権限・UI・監査ログの完全一致を保証する

以下の3点が 必ず一致 する設計にする：
	1.	実行できる操作（authorize）
	2.	画面に表示されるUI（can?）
	3.	残る監査ログ（audit_logs）

	•	権限キーは 単一の命名規則 に統一する
	•	例：admin.tenants.create
	•	UI 側の分岐は can? のみを使用
	•	Controller 側は authorize! を必須化

⸻

3️⃣ 権限・メニュー・画面定義の「宣言的」管理

以下を コードで散らさない こと：
	•	管理画面のサイドバー構造
	•	各画面に必要な権限
	•	画面の論理構造（一覧 / 新規 / 編集 / 削除）

👉 目標：

「新しい管理画面を1つ追加する時、迷わず同じ形で作れる」

例：
	•	Admin::Navigation
	•	Admin::Screens::Tenants
	•	YAML / Ruby 定数 / Struct などでの定義

⸻

4️⃣ 運用者向けUXの改善
	•	管理画面に最低限必要なものを整備
	•	ページタイトルの統一
	•	パンくずリスト
	•	空状態（Empty State）の明示
	•	破壊的操作の確認UI
	•	「誰が見ても分かる管理画面」を意識する

⸻

5️⃣ 将来拡張を前提にした設計整理

以下を 今のうちに整理 する：
	•	built-in ロールとカスタムロールの扱い
	•	業種別機能追加を想定した拡張ポイント
	•	設定系（Settings / Feature Flags）の置き場所
	•	法人化・複数管理者を想定した設計

⸻

🧪 必須テスト方針（超重要）

以下を テストで固定 すること：
	•	権限がないと操作できない
	•	UI に表示されない操作は実行できない
	•	全ての重要操作に audit_log が残る

👉
「壊れたらすぐ気づく」状態を作る

⸻

📁 成果物として期待するもの
	•	Admin::BaseController の完成形
	•	権限・ナビゲーション・画面定義の構造
	•	管理画面追加時のテンプレート
	•	docs/architecture/phase2_operability.md
	•	なぜこの設計なのか
	•	フェーズ3への布石

⸻

🚫 このフェーズでやらないこと
	•	新しい業務機能の大量追加
	•	UI の派手なデザイン改善
	•	顧客向け機能の拡張

👉 目的は「楽に・安全に回る状態」を作ること

⸻

✅ ゴール定義

「半年後の自分、または他人が
管理画面・権限・監査を触っても
怖くない・迷わない・壊さない 状態」