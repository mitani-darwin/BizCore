あなたは Rails 8 / 業務システム向けマルチテナントSaaS の品質設計に精通したエンジニアです。
以下の設計思想を 自動テストで破壊不能にする「網羅テスト3点セット」を実装してください。

守るべき三位一体（完全一致）
	1.	UI に表示される = can?(permission_key) が true
	2.	実行できる = authorize!(permission_key) が通る
	3.	実行された = AuditLog.action_key == permission_key が残る

⸻

前提（既に存在するもの）
	•	Permission seed（admin.*）がある（Step2）
	•	Authorization.can? / authorize! がある（Step3）
	•	Admin::Navigation が required_keys を持ち、可視メニューを返す（Step4）
	•	監査ログ AuditLog がある（Step1）
	•	RSpec が使える（なければ最小導入も可）

⸻

ゴール（成果物）

次の 3種類の網羅テストを追加し、CIで常に整合性を保証する。

テスト①：Routes/Controller × Permission key の網羅
	•	Admin:: 配下の controller/action を列挙し、
想定される permission key が Permission seed に存在すること
	•	さらに可能なら「各 action で authorize! が呼ばれている」ことを検査（難しければ TODO/簡易でOK）

テスト②：Navigation × Permission key の網羅
	•	Admin::Navigation.items に含まれる required_keys がすべて
Permission.key に存在すること（タイポ検知）
	•	親子構造を走査して漏れなくチェック

テスト③：監査ログ action_key × Permission key の一致
	•	代表的な admin アクション（例：TenantsController#update）を叩いたとき
	•	AuditLog が1件増える
	•	AuditLog.action_key が期待の permission key と一致する
	•	AuditLog.tenant_id が入る

⸻

実装要件（重要）

A) Permission key の “単一ソース” を定義

テストが seed とズレないよう、以下のどちらかを採用：

案1（推奨）：Permissions::Catalog のような Ruby 定数カタログを作り、
	•	seed は catalog を参照して作る
	•	tests も catalog を参照する

案2：seed 内の定義を読み取りやすい形（Hash）にして、
	•	テストは Permission テーブルの key から照合する

今回は 変更範囲が小さい方を採用してOKだが、
「テストの期待値がハードコードで増殖しない」ことを最優先にする。

⸻

B) Admin action の列挙方法

Routes から admin/ 名前空間を抽出して列挙するか、
Rails.application.routes.routes から controller/action を取り出してもよい。
	•	対象は Admin:: の controller に限定
	•	rails routes 相当の情報から controller#action を取る
	•	除外：devise/rails internal などノイズが入るなら除外条件を入れる

⸻

C) 「この action はどの key を authorize すべきか」の規約

最低限、規約を決めてテストする。

例：REST 規約
	•	index/show => admin.{resource}.read
	•	new/create => admin.{resource}.create
	•	edit/update => admin.{resource}.update
	•	destroy => admin.{resource}.delete

ここでの {resource} は controller 名から推定（tenants/users/roles…）

この規約に合わない action は
	•	SKIP リストで除外する
	•	もしくは MAP で明示定義する

⸻

D) Navigation の required_keys 走査
	•	Admin::Navigation.items を再帰的に走査し、
すべての required_keys を flatten
	•	重複除去し、存在チェック

⸻

E) 監査ログテストの前提整備
	•	テスト用に tenant と actor(user) を作る（FactoryBotなど）
	•	認可が絡む場合は can? を通るようスタブ or 最小実装
	•	Admin::TenantsController#update を request spec で叩けるようにする
	•	AuditLog.last.action_key を検証

⸻

出力してほしいもの（ファイル単位でコード全文）
	•	spec/ 配下にテスト3本（または 1ファイルに3 describe でもOK）
	•	必要ならテスト支援のヘルパ（例：spec/support/admin_route_helpers.rb）
	•	必要なら Permission カタログ（app/models/permissions/catalog.rb 等）
	•	既存の seed を Catalog 化する場合は差分も提示
	•	README 1枚：doc/architecture/authorization/consistency_tests.md
	•	3点セットの意図
	•	落ちた時に何がズレたかの読み方
	•	新規画面を足した時に何を更新するか

⸻

出力形式（厳守）
	•	ファイルパス
	•	コード全文
	•	（必要なら）既存ファイルの変更点は “差分” ではなく完成形で提示

⸻

このプロンプトに従って、網羅テスト3点セットを実装してください。